import fs from 'fs';
import path from 'path';
import marked from 'marked'; // Ajout du module pour conversion Markdown -> HTML

// G√©n√®re un guide d‚Äôonboarding interactif √† partir des scripts et automatisations du projet
const files = fs.readdirSync(__dirname).filter(f => f.endsWith('.js') && !f.startsWith('.'));
let md = `# üöÄ Onboarding MayaVoiceTranslator\n\nBienvenue ! Voici les scripts et automatisations disponibles pour piloter et contribuer au projet.\n\n## Scripts principaux\n`;
md += files.map(f=>`- \`${f}\``).join('\n');
md += `\n\n## Endpoints et reporting\n- Dashboard : [dashboard.html](./docs/dashboard.html)\n- Rapport interactif : [rapport_sprint.html](./docs/rapport_sprint.html)\n- API REST locale : /api/report, /api/dashboard\n\n## Conseils\n- Consultez le README pour la configuration des secrets et l‚Äôacc√®s aux rapports publics.\n- Utilisez la pipeline CI/CD pour automatiser toutes les t√¢ches.\n\n## Tutoriels rapides\n- [D√©marrer la pipeline](#)\n- [Consulter le dashboard](#)\n- [Exporter un rapport](#)\n- [Ajouter une int√©gration externe](#)\n\n## FAQ\n- **Comment configurer les secrets ?**\n  Voir la section d√©di√©e dans le README.\n- **Comment restaurer une archive ?**\n  T√©l√©charger l‚Äôarchive ZIP du sprint dans docs/history/ et extraire les fichiers n√©cessaires.\n- **Comment recevoir les notifications ?**\n  V√©rifier que les webhooks email/Slack/Discord sont bien configur√©s dans les secrets GitHub.\n\n## Liens utiles\n- [Site officiel](https://cedbe.github.io/MayaVoiceTranslator/)\n- [Documentation GitHub](https://github.com/cedbe/MayaVoiceTranslator)\n- [Dashboard public](./docs/dashboard.html)\n- [Rapport interactif](./docs/rapport_sprint.html)\n- [Index des archives](./docs/history/index.html)\n\n## Contacts\n- Email support : support@mayavoicetranslator.org\n- Discord : https://discord.gg/xxxxxxx\n- Slack : (sur demande)\n\n## Roadmap\n- Am√©lioration continue de l‚Äôautomatisation (CI/CD, reporting, s√©curit√©)\n- Int√©gration d‚Äôoutils externes (Notion, Trello, Jira, etc.)\n- Visualisation avanc√©e et analytics\n- Suggestions IA et automatisation intelligente\n- Ouverture √† la communaut√© et documentation multilingue\n\n## Comment contribuer\n- Forkez le repo et proposez vos Pull Requests\n- Ouvrez une issue pour toute suggestion ou bug\n- Respectez le Code of Conduct\n- Consultez la documentation et le guide d‚Äôonboarding\n- Participez aux discussions sur Discord/Slack\n\n## Glossaire\n- **Pipeline** : suite d‚Äô√©tapes automatis√©es pour le pilotage projet\n- **Sprint** : p√©riode de travail avec objectifs d√©finis\n- **CI/CD** : Int√©gration et d√©ploiement continus\n- **Webhook** : m√©canisme de notification automatique entre outils\n- **Badge** : indicateur visuel de statut ou de progression\n- **Dashboard** : tableau de bord interactif du projet\n- **Archive** : sauvegarde dat√©e des livrables\n- **Changelog** : historique des modifications du projet\n- **Onboarding** : processus d‚Äôaccueil et de prise en main\n- **Issue** : ticket de suivi (t√¢che, bug, suggestion)\n- **Pull Request (PR)** : proposition de modification du code\n\n## Historique\n- 2024 : Cr√©ation du projet MayaVoiceTranslator\n- 2025 : Automatisation compl√®te du pilotage projet (CI/CD, reporting, s√©curit√©, onboarding)\n- 2025 : Publication GitHub Pages, API REST, synchronisation cloud\n- 2025 : Ouverture √† la communaut√© et int√©grations externes\n\n## Cr√©dits\n- Contributeur principal : @cedbe\n- Outils open source : Node.js, Chart.js, rclone, GitHub Actions, etc.\n- Merci √† tous les testeurs, contributeurs et utilisateurs !\n`;
md += `\n\n## Mentions l√©gales\n- Projet open source sous licence MIT\n- Propri√©t√© intellectuelle : MayaVoiceTranslator, @cedbe\n- Aucune garantie, usage √† vos risques\n\n## Politique de confidentialit√©\n- Les donn√©es utilisateurs ne sont ni collect√©es ni revendues\n- Les logs sont utilis√©s uniquement pour l‚Äôam√©lioration du projet\n- Conformit√© RGPD : droit d‚Äôacc√®s, de rectification et de suppression sur demande\n`;
md += `\n\n## Support\n- Consultez la FAQ ci-dessus\n- Ouvrez une issue sur GitHub : https://github.com/cedbe/MayaVoiceTranslator/issues\n- Rejoignez le Discord pour de l‚Äôaide en temps r√©el\n- Contact email : support@mayavoicetranslator.org\n\n## Escalade\n- Pour tout bug critique ou faille de s√©curit√©, contactez imm√©diatement le mainteneur principal\n- Email d‚Äôurgence : security@mayavoicetranslator.org\n- Mentionnez [URGENT] dans l‚Äôobjet pour un traitement prioritaire\n`;
md += `\n\n## Ressources pour aller plus loin\n- [Node.js Documentation](https://nodejs.org/en/docs/)\n- [GitHub Actions Guide](https://docs.github.com/en/actions)\n- [Automatisation avec rclone](https://rclone.org/docs/)\n- [Chart.js Documentation](https://www.chartjs.org/docs/latest/)\n- [Gestion de projet agile (MOOC)](https://www.fun-mooc.fr/fr/cours/agile/)\n- [S√©curit√© open source (OpenSSF)](https://openssf.org/)\n- [Open source et contribution](https://opensource.guide/how-to-contribute/)\n`;
md += `\n\n## Exemples d‚Äôutilisation rapide\n\n- G√©n√©rer le rapport de sprint :\n  \`\`\`bash\nnode generate_report.js sprint_planning.csv rapport_sprint.md\n\`\`\`\n- G√©n√©rer le dashboard interactif :\n  \`\`\`bash\nnode generate_dashboard.js sprint_planning.csv dashboard.html\n\`\`\`\n- Lancer la pipeline compl√®te :\n  \`\`\`bash\nnode project_pipeline.js <github_owner> <github_repo> <github_token>\n\`\`\`\n- Exporter le planning en JSON :\n  \`\`\`bash\nnode export_planning_json.js sprint_planning.csv sprint_planning.json\n\`\`\`\n`;
md += `\n\n## Diagnostic & r√©solution des probl√®mes courants\n- **Erreur : module introuvable**\n  ‚Üí Lancer \`npm install\` pour installer les d√©pendances.\n- **Erreur : permission refus√©e**\n  ‚Üí V√©rifier les droits sur les fichiers/dossiers, relancer avec les bons droits.\n- **Secrets manquants**\n  ‚Üí V√©rifier la configuration des secrets dans GitHub Actions ou le fichier .env.\n- **Pipeline √©chou√©e**\n  ‚Üí Consulter le badge de statut, les logs dans docs/history/ et relancer la pipeline.\n- **Synchronisation cloud √©chou√©e**\n  ‚Üí V√©rifier la configuration de rclone et la variable d‚Äôenvironnement RCLONE_REMOTE.\n`;
md += `

## Personnalisation & extensions possibles
- Ajouter de nouveaux formats de reporting (CSV, XLSX, API REST avanc√©e...)
- Int√©grer d‚Äôautres outils externes (Jira, Notion, Trello, Slack, Teams...)
- Automatiser la traduction ou la g√©n√©ration de documentation multilingue
- Ajouter des tests automatis√©s ou des badges de qualit√© suppl√©mentaires
- D√©ployer la pipeline sur d‚Äôautres plateformes (Vercel, Render, AWS...)
- Adapter le workflow √† d‚Äôautres types de projets (data, IA, mobile...)
`;
md += `

## Limites connues & points de vigilance
- D√©pendance √† GitHub Actions pour l‚Äôautomatisation CI/CD (peut n√©cessiter adaptation sur d‚Äôautres plateformes)
- Quotas et limitations des APIs externes (GitHub, Slack, Discord, rclone...)
- La synchronisation cloud n√©cessite une configuration pr√©alable de rclone
- Les secrets doivent √™tre correctement configur√©s pour √©viter les √©checs de pipeline
- Certaines automatisations avanc√©es requi√®rent des droits administrateur sur le repo
- Les rapports g√©n√©r√©s sont publics si le dossier docs/ est publi√© sur GitHub Pages
`;
md += `

## Questions fr√©quentes de la communaut√©
- **Comment obtenir un token GitHub pour la pipeline‚ÄØ?**
  ‚Üí Suivez la documentation officielle GitHub pour g√©n√©rer un token avec les droits repo.
- **Comment ajouter une nouvelle int√©gration externe‚ÄØ?**
  ‚Üí Utilisez le script integrate_external_tools.js et adaptez-le √† l‚ÄôAPI cible.
- **Pourquoi la synchronisation cloud √©choue-t-elle parfois‚ÄØ?**
  ‚Üí V√©rifiez la configuration rclone, les quotas cloud et la variable d‚Äôenvironnement RCLONE_REMOTE.
- **Comment restaurer un rapport ou dashboard d‚Äôarchive‚ÄØ?**
  ‚Üí T√©l√©chargez l‚Äôarchive ZIP du sprint dans docs/history/ et extrayez les fichiers n√©cessaires.
- **Comment contribuer √† la documentation‚ÄØ?**
  ‚Üí Proposez une Pull Request ou ouvrez une issue avec vos suggestions.
`;

// Ajout de la section Mises √† jour & nouveaut√©s r√©centes (extrait du changelog)
let changelog = '';
try {
  if (fs.existsSync('CHANGELOG.md')) {
    const cl = fs.readFileSync('CHANGELOG.md', 'utf8').split(/^## /m)[1];
    if (cl) changelog = '## Mises √† jour & nouveaut√©s r√©centes\n\n' + cl.trim().split('\n').slice(0, 10).join('\n') + '\n';
  }
} catch {}
md += `\n${changelog}`;

md += `

## √Ä propos du projet & vision
MayaVoiceTranslator vise √† d√©mocratiser l‚Äôacc√®s √† la traduction et √† l‚Äôapprentissage multilingue gr√¢ce √† l‚Äôautomatisation, l‚Äôopen source et la collaboration internationale.
Notre vision : un pilotage projet ultra-automatis√©, transparent, √©thique et accessible √† tous, pour acc√©l√©rer l‚Äôinnovation linguistique et l‚Äôinclusion num√©rique.
`;
md += `

## Comment obtenir de l‚Äôaide personnalis√©e
- Rejoignez le Discord pour poser vos questions en direct √† la communaut√© ou aux mainteneurs
- Demandez une session de d√©mo ou d‚Äôonboarding personnalis√© par email (support@mayavoicetranslator.org)
- Proposez une visio ou un atelier d‚Äô√©quipe pour acc√©l√©rer la prise en main
- Consultez la section Support & Escalade pour les cas urgents ou critiques
`;

fs.writeFileSync(path.join('docs', 'ONBOARDING.md'), md, 'utf8');
console.log('Guide ONBOARDING.md g√©n√©r√© dans docs/');

// === G√©n√©ration multilingue (10 principales langues) ===
const templates = {
  fr: md,
  en: `# üöÄ MayaVoiceTranslator Onboarding\n\nWelcome! Here are the available scripts and automations to manage and contribute to the project.\n\n(English template. Please refer to the French version for full details. Translation to be completed.)`,
  es: `# üöÄ Onboarding MayaVoiceTranslator\n\n¬°Bienvenido! Aqu√≠ est√°n los scripts y automatizaciones disponibles para gestionar y contribuir al proyecto.\n\n(Plantilla en espa√±ol. Consulte la versi√≥n francesa para m√°s detalles. Traducci√≥n en curso.)`,
  de: `# üöÄ MayaVoiceTranslator Onboarding\n\nWillkommen! Hier sind die verf√ºgbaren Skripte und Automatisierungen f√ºr das Projektmanagement und die Mitarbeit.\n\n(Deutsche Vorlage. F√ºr Details siehe franz√∂sische Version. √úbersetzung folgt.)`,
  pt: `# üöÄ Onboarding MayaVoiceTranslator\n\nBem-vindo! Aqui est√£o os scripts e automa√ß√µes dispon√≠veis para gerenciar e contribuir para o projeto.\n\n(Modelo em portugu√™s. Consulte a vers√£o francesa para mais detalhes. Tradu√ß√£o em andamento.)`,
  it: `# üöÄ Onboarding MayaVoiceTranslator\n\nBenvenuto! Qui trovi gli script e le automazioni disponibili per gestire e contribuire al progetto.\n\n(Modello italiano. Per i dettagli, vedere la versione francese. Traduzione in corso.)`,
  nl: `# üöÄ MayaVoiceTranslator Onboarding\n\nWelkom! Hier zijn de beschikbare scripts en automatiseringen om aan het project bij te dragen.\n\n(Nederlandse template. Raadpleeg de Franse versie voor details. Vertaling volgt.)`,
  zh: `# üöÄ MayaVoiceTranslator ÂÖ•Èó®ÊåáÂçó\n\nÊ¨¢ËøéÔºÅ‰ª•‰∏ãÊòØÂèØÁî®‰∫éÁÆ°ÁêÜÂíåË¥°ÁåÆÈ°πÁõÆÁöÑËÑöÊú¨ÂíåËá™Âä®Âåñ„ÄÇ\n\nÔºà‰∏≠ÊñáÊ®°Êùø„ÄÇËØ¶ÊÉÖËØ∑ÂèÇÈòÖÊ≥ïÊñáÁâà„ÄÇÁøªËØëÂæÖÂÆåÂñÑ„ÄÇÔºâ`,
  ar: `# üöÄ ÿØŸÑŸäŸÑ ÿßŸÑÿ®ÿØÿ° ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸÑŸÄ MayaVoiceTranslator\n\nŸÖÿ±ÿ≠ÿ®Ÿãÿß! ÿ•ŸÑŸäŸÉ ÿßŸÑÿ≥ŸÉÿ±Ÿäÿ®ÿ™ÿßÿ™ ŸàÿßŸÑÿ£ÿ™ŸÖÿ™ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸàÿßŸÑŸÖÿ≥ÿßŸáŸÖÿ© ŸÅŸäŸá.\n\n(ŸÇÿßŸÑÿ® ÿπÿ±ÿ®Ÿä. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ±ÿ¨Ÿàÿπ ÿ•ŸÑŸâ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÅÿ±ŸÜÿ≥Ÿäÿ© ŸÑŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ. ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ŸÇŸäÿØ ÿßŸÑÿ•ÿπÿØÿßÿØ.)`,
  ru: `# üöÄ –í–≤–µ–¥–µ–Ω–∏–µ –≤ MayaVoiceTranslator\n\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º –∏ —É—á–∞—Å—Ç–∏—è –≤ –Ω–µ–º.\n\n(–†—É—Å—Å–∫–∏–π —à–∞–±–ª–æ–Ω. –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π —Å–º–æ—Ç—Ä–∏—Ç–µ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫—É—é –≤–µ—Ä—Å–∏—é. –ü–µ—Ä–µ–≤–æ–¥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ.)`,
};
for (const [lang, content] of Object.entries(templates)) {
  fs.writeFileSync(path.join('docs', `ONBOARDING_${lang}.md`), content, 'utf8');
  // G√©n√©ration HTML √† partir du Markdown
  const html = `<!DOCTYPE html><html><head><meta charset='utf-8'><title>Onboarding MayaVoiceTranslator (${lang})</title><style>body{font-family:sans-serif;max-width:800px;margin:auto;padding:2em;}h1{color:#2a5d9f}pre,code{background:#f4f4f4;padding:2px 4px;border-radius:3px;}a{color:#2a5d9f;text-decoration:underline;}table{border-collapse:collapse;width:100%}th,td{border:1px solid #ccc;padding:6px}th{background:#eee}</style></head><body>` + marked.parse(content) + `</body></html>`;
  fs.writeFileSync(path.join('docs', `ONBOARDING_${lang}.html`), html, 'utf8');
}
console.log('Guides ONBOARDING multilingues g√©n√©r√©s dans docs/ (fr, en, es, de, pt, it, nl, zh, ar, ru)');
